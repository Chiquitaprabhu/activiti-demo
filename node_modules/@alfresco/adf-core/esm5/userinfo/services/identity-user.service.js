/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Injectable } from '@angular/core';
import { from, of } from 'rxjs';
import { map, switchMap } from 'rxjs/operators';
import { IdentityUserModel } from '../models/identity-user.model';
import { JwtHelperService } from '../../services/jwt-helper.service';
import { AppConfigService } from '../../app-config/app-config.service';
import { AlfrescoApiService } from '../../services/alfresco-api.service';
import * as i0 from "@angular/core";
import * as i1 from "../../services/jwt-helper.service";
import * as i2 from "../../services/alfresco-api.service";
import * as i3 from "../../app-config/app-config.service";
var IdentityUserService = /** @class */ (function () {
    function IdentityUserService(jwtHelperService, alfrescoApiService, appConfigService) {
        this.jwtHelperService = jwtHelperService;
        this.alfrescoApiService = alfrescoApiService;
        this.appConfigService = appConfigService;
    }
    /**
     * Gets the name and other basic details of the current user.
     * @returns The user's details
     */
    /**
     * Gets the name and other basic details of the current user.
     * @return {?} The user's details
     */
    IdentityUserService.prototype.getCurrentUserInfo = /**
     * Gets the name and other basic details of the current user.
     * @return {?} The user's details
     */
    function () {
        /** @type {?} */
        var familyName = this.jwtHelperService.getValueFromLocalAccessToken(JwtHelperService.FAMILY_NAME);
        /** @type {?} */
        var givenName = this.jwtHelperService.getValueFromLocalAccessToken(JwtHelperService.GIVEN_NAME);
        /** @type {?} */
        var email = this.jwtHelperService.getValueFromLocalAccessToken(JwtHelperService.USER_EMAIL);
        /** @type {?} */
        var username = this.jwtHelperService.getValueFromLocalAccessToken(JwtHelperService.USER_PREFERRED_USERNAME);
        /** @type {?} */
        var user = { firstName: givenName, lastName: familyName, email: email, username: username };
        return new IdentityUserModel(user);
    };
    /**
     * Find users based on search input.
     * @param search Search query string
     * @returns List of users
     */
    /**
     * Find users based on search input.
     * @param {?} search Search query string
     * @return {?} List of users
     */
    IdentityUserService.prototype.findUsersByName = /**
     * Find users based on search input.
     * @param {?} search Search query string
     * @return {?} List of users
     */
    function (search) {
        if (search === '') {
            return of([]);
        }
        /** @type {?} */
        var url = this.buildUserUrl();
        /** @type {?} */
        var httpMethod = 'GET';
        /** @type {?} */
        var pathParams = {};
        /** @type {?} */
        var queryParams = { search: search };
        /** @type {?} */
        var bodyParam = {};
        /** @type {?} */
        var headerParams = {};
        /** @type {?} */
        var formParams = {};
        /** @type {?} */
        var contentTypes = ['application/json'];
        /** @type {?} */
        var accepts = ['application/json'];
        return (from(this.alfrescoApiService.getInstance().oauth2Auth.callCustomApi(url, httpMethod, pathParams, queryParams, headerParams, formParams, bodyParam, contentTypes, accepts, Object, null, null)));
    };
    /**
     * Find users based on username input.
     * @param username Search query string
     * @returns List of users
     */
    /**
     * Find users based on username input.
     * @param {?} username Search query string
     * @return {?} List of users
     */
    IdentityUserService.prototype.findUserByUsername = /**
     * Find users based on username input.
     * @param {?} username Search query string
     * @return {?} List of users
     */
    function (username) {
        if (username === '') {
            return of([]);
        }
        /** @type {?} */
        var url = this.buildUserUrl();
        /** @type {?} */
        var httpMethod = 'GET';
        /** @type {?} */
        var pathParams = {};
        /** @type {?} */
        var queryParams = { username: username };
        /** @type {?} */
        var bodyParam = {};
        /** @type {?} */
        var headerParams = {};
        /** @type {?} */
        var formParams = {};
        /** @type {?} */
        var contentTypes = ['application/json'];
        /** @type {?} */
        var accepts = ['application/json'];
        return (from(this.alfrescoApiService.getInstance().oauth2Auth.callCustomApi(url, httpMethod, pathParams, queryParams, headerParams, formParams, bodyParam, contentTypes, accepts, Object, null, null)));
    };
    /**
     * Find users based on email input.
     * @param email Search query string
     * @returns List of users
     */
    /**
     * Find users based on email input.
     * @param {?} email Search query string
     * @return {?} List of users
     */
    IdentityUserService.prototype.findUserByEmail = /**
     * Find users based on email input.
     * @param {?} email Search query string
     * @return {?} List of users
     */
    function (email) {
        if (email === '') {
            return of([]);
        }
        /** @type {?} */
        var url = this.buildUserUrl();
        /** @type {?} */
        var httpMethod = 'GET';
        /** @type {?} */
        var pathParams = {};
        /** @type {?} */
        var queryParams = { email: email };
        /** @type {?} */
        var bodyParam = {};
        /** @type {?} */
        var headerParams = {};
        /** @type {?} */
        var formParams = {};
        /** @type {?} */
        var contentTypes = ['application/json'];
        /** @type {?} */
        var accepts = ['application/json'];
        return (from(this.alfrescoApiService.getInstance().oauth2Auth.callCustomApi(url, httpMethod, pathParams, queryParams, headerParams, formParams, bodyParam, contentTypes, accepts, Object, null, null)));
    };
    /**
     * Find users based on id input.
     * @param id Search query string
     * @returns users object
     */
    /**
     * Find users based on id input.
     * @param {?} id Search query string
     * @return {?} users object
     */
    IdentityUserService.prototype.findUserById = /**
     * Find users based on id input.
     * @param {?} id Search query string
     * @return {?} users object
     */
    function (id) {
        if (id === '') {
            return of([]);
        }
        /** @type {?} */
        var url = this.buildUserUrl() + '/' + id;
        /** @type {?} */
        var httpMethod = 'GET';
        /** @type {?} */
        var pathParams = {};
        /** @type {?} */
        var queryParams = {};
        /** @type {?} */
        var bodyParam = {};
        /** @type {?} */
        var headerParams = {};
        /** @type {?} */
        var formParams = {};
        /** @type {?} */
        var contentTypes = ['application/json'];
        /** @type {?} */
        var accepts = ['application/json'];
        return (from(this.alfrescoApiService.getInstance().oauth2Auth.callCustomApi(url, httpMethod, pathParams, queryParams, headerParams, formParams, bodyParam, contentTypes, accepts, Object, null, null)));
    };
    /**
     * Get client roles of a user for a particular client.
     * @param userId ID of the target user
     * @param clientId ID of the client app
     * @returns List of client roles
     */
    /**
     * Get client roles of a user for a particular client.
     * @param {?} userId ID of the target user
     * @param {?} clientId ID of the client app
     * @return {?} List of client roles
     */
    IdentityUserService.prototype.getClientRoles = /**
     * Get client roles of a user for a particular client.
     * @param {?} userId ID of the target user
     * @param {?} clientId ID of the client app
     * @return {?} List of client roles
     */
    function (userId, clientId) {
        /** @type {?} */
        var url = this.buildUserClientRoleMapping(userId, clientId);
        /** @type {?} */
        var httpMethod = 'GET';
        /** @type {?} */
        var pathParams = {};
        /** @type {?} */
        var queryParams = {};
        /** @type {?} */
        var bodyParam = {};
        /** @type {?} */
        var headerParams = {};
        /** @type {?} */
        var formParams = {};
        /** @type {?} */
        var contentTypes = ['application/json'];
        /** @type {?} */
        var accepts = ['application/json'];
        return from(this.alfrescoApiService.getInstance().oauth2Auth.callCustomApi(url, httpMethod, pathParams, queryParams, headerParams, formParams, bodyParam, contentTypes, accepts, Object, null, null));
    };
    /**
     * Checks whether user has access to a client app.
     * @param userId ID of the target user
     * @param clientId ID of the client app
     * @returns True if the user has access, false otherwise
     */
    /**
     * Checks whether user has access to a client app.
     * @param {?} userId ID of the target user
     * @param {?} clientId ID of the client app
     * @return {?} True if the user has access, false otherwise
     */
    IdentityUserService.prototype.checkUserHasClientApp = /**
     * Checks whether user has access to a client app.
     * @param {?} userId ID of the target user
     * @param {?} clientId ID of the client app
     * @return {?} True if the user has access, false otherwise
     */
    function (userId, clientId) {
        return this.getClientRoles(userId, clientId).pipe(map((/**
         * @param {?} clientRoles
         * @return {?}
         */
        function (clientRoles) {
            if (clientRoles.length > 0) {
                return true;
            }
            return false;
        })));
    };
    /**
     * Checks whether a user has any of the client app roles.
     * @param userId ID of the target user
     * @param clientId ID of the client app
     * @param roleNames List of role names to check for
     * @returns True if the user has one or more of the roles, false otherwise
     */
    /**
     * Checks whether a user has any of the client app roles.
     * @param {?} userId ID of the target user
     * @param {?} clientId ID of the client app
     * @param {?} roleNames List of role names to check for
     * @return {?} True if the user has one or more of the roles, false otherwise
     */
    IdentityUserService.prototype.checkUserHasAnyClientAppRole = /**
     * Checks whether a user has any of the client app roles.
     * @param {?} userId ID of the target user
     * @param {?} clientId ID of the client app
     * @param {?} roleNames List of role names to check for
     * @return {?} True if the user has one or more of the roles, false otherwise
     */
    function (userId, clientId, roleNames) {
        return this.getClientRoles(userId, clientId).pipe(map((/**
         * @param {?} clientRoles
         * @return {?}
         */
        function (clientRoles) {
            /** @type {?} */
            var hasRole = false;
            if (clientRoles.length > 0) {
                roleNames.forEach((/**
                 * @param {?} roleName
                 * @return {?}
                 */
                function (roleName) {
                    /** @type {?} */
                    var role = clientRoles.find((/**
                     * @param {?} availableRole
                     * @return {?}
                     */
                    function (availableRole) {
                        return availableRole.name === roleName;
                    }));
                    if (role) {
                        hasRole = true;
                        return;
                    }
                }));
            }
            return hasRole;
        })));
    };
    /**
     * Gets the client ID for an application.
     * @param applicationName Name of the application
     * @returns Client ID string
     */
    /**
     * Gets the client ID for an application.
     * @param {?} applicationName Name of the application
     * @return {?} Client ID string
     */
    IdentityUserService.prototype.getClientIdByApplicationName = /**
     * Gets the client ID for an application.
     * @param {?} applicationName Name of the application
     * @return {?} Client ID string
     */
    function (applicationName) {
        /** @type {?} */
        var url = this.buildGetClientsUrl();
        /** @type {?} */
        var httpMethod = 'GET';
        /** @type {?} */
        var pathParams = {};
        /** @type {?} */
        var queryParams = { clientId: applicationName };
        /** @type {?} */
        var bodyParam = {};
        /** @type {?} */
        var headerParams = {};
        /** @type {?} */
        var formParams = {};
        /** @type {?} */
        var contentTypes = ['application/json'];
        /** @type {?} */
        var accepts = ['application/json'];
        return from(this.alfrescoApiService.getInstance()
            .oauth2Auth.callCustomApi(url, httpMethod, pathParams, queryParams, headerParams, formParams, bodyParam, contentTypes, accepts, Object, null, null)).pipe(map((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            /** @type {?} */
            var clientId = response && response.length > 0 ? response[0].id : '';
            return clientId;
        })));
    };
    /**
     * Checks if a user has access to an application.
     * @param userId ID of the user
     * @param applicationName Name of the application
     * @returns True if the user has access, false otherwise
     */
    /**
     * Checks if a user has access to an application.
     * @param {?} userId ID of the user
     * @param {?} applicationName Name of the application
     * @return {?} True if the user has access, false otherwise
     */
    IdentityUserService.prototype.checkUserHasApplicationAccess = /**
     * Checks if a user has access to an application.
     * @param {?} userId ID of the user
     * @param {?} applicationName Name of the application
     * @return {?} True if the user has access, false otherwise
     */
    function (userId, applicationName) {
        var _this = this;
        return this.getClientIdByApplicationName(applicationName).pipe(switchMap((/**
         * @param {?} clientId
         * @return {?}
         */
        function (clientId) {
            return _this.checkUserHasClientApp(userId, clientId);
        })));
    };
    /**
     * Checks if a user has any application role.
     * @param userId ID of the target user
     * @param applicationName Name of the application
     * @param roleNames List of role names to check for
     * @returns True if the user has one or more of the roles, false otherwise
     */
    /**
     * Checks if a user has any application role.
     * @param {?} userId ID of the target user
     * @param {?} applicationName Name of the application
     * @param {?} roleNames List of role names to check for
     * @return {?} True if the user has one or more of the roles, false otherwise
     */
    IdentityUserService.prototype.checkUserHasAnyApplicationRole = /**
     * Checks if a user has any application role.
     * @param {?} userId ID of the target user
     * @param {?} applicationName Name of the application
     * @param {?} roleNames List of role names to check for
     * @return {?} True if the user has one or more of the roles, false otherwise
     */
    function (userId, applicationName, roleNames) {
        var _this = this;
        return this.getClientIdByApplicationName(applicationName).pipe(switchMap((/**
         * @param {?} clientId
         * @return {?}
         */
        function (clientId) {
            return _this.checkUserHasAnyClientAppRole(userId, clientId, roleNames);
        })));
    };
    /**
     * Gets details for all users.
     * @returns Array of user info objects
     */
    /**
     * Gets details for all users.
     * @return {?} Array of user info objects
     */
    IdentityUserService.prototype.getUsers = /**
     * Gets details for all users.
     * @return {?} Array of user info objects
     */
    function () {
        /** @type {?} */
        var url = this.buildUserUrl();
        /** @type {?} */
        var httpMethod = 'GET';
        /** @type {?} */
        var pathParams = {};
        /** @type {?} */
        var queryParams = {};
        /** @type {?} */
        var bodyParam = {};
        /** @type {?} */
        var headerParams = {};
        /** @type {?} */
        var formParams = {};
        /** @type {?} */
        var authNames = [];
        /** @type {?} */
        var contentTypes = ['application/json'];
        /** @type {?} */
        var accepts = ['application/json'];
        return from(this.alfrescoApiService.getInstance().oauth2Auth.callCustomApi(url, httpMethod, pathParams, queryParams, headerParams, formParams, bodyParam, authNames, contentTypes, accepts, null, null)).pipe(map((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            return response;
        })));
    };
    /**
     * Gets a list of roles for a user.
     * @param userId ID of the user
     * @returns Array of role info objects
     */
    /**
     * Gets a list of roles for a user.
     * @param {?} userId ID of the user
     * @return {?} Array of role info objects
     */
    IdentityUserService.prototype.getUserRoles = /**
     * Gets a list of roles for a user.
     * @param {?} userId ID of the user
     * @return {?} Array of role info objects
     */
    function (userId) {
        /** @type {?} */
        var url = this.buildRolesUrl(userId);
        /** @type {?} */
        var httpMethod = 'GET';
        /** @type {?} */
        var pathParams = {};
        /** @type {?} */
        var queryParams = {};
        /** @type {?} */
        var bodyParam = {};
        /** @type {?} */
        var headerParams = {};
        /** @type {?} */
        var formParams = {};
        /** @type {?} */
        var contentTypes = ['application/json'];
        /** @type {?} */
        var accepts = ['application/json'];
        return from(this.alfrescoApiService.getInstance().oauth2Auth.callCustomApi(url, httpMethod, pathParams, queryParams, headerParams, formParams, bodyParam, contentTypes, accepts, Object, null, null)).pipe(map((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            return response;
        })));
    };
    /**
     * Gets an array of users (including the current user) who have any of the roles in the supplied list.
     * @param roleNames List of role names to look for
     * @returns Array of user info objects
     */
    /**
     * Gets an array of users (including the current user) who have any of the roles in the supplied list.
     * @param {?} roleNames List of role names to look for
     * @return {?} Array of user info objects
     */
    IdentityUserService.prototype.getUsersByRolesWithCurrentUser = /**
     * Gets an array of users (including the current user) who have any of the roles in the supplied list.
     * @param {?} roleNames List of role names to look for
     * @return {?} Array of user info objects
     */
    function (roleNames) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var filteredUsers, users, i, hasAnyRole;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        filteredUsers = [];
                        if (!(roleNames && roleNames.length > 0)) return [3 /*break*/, 5];
                        return [4 /*yield*/, this.getUsers().toPromise()];
                    case 1:
                        users = _a.sent();
                        i = 0;
                        _a.label = 2;
                    case 2:
                        if (!(i < users.length)) return [3 /*break*/, 5];
                        return [4 /*yield*/, this.userHasAnyRole(users[i].id, roleNames)];
                    case 3:
                        hasAnyRole = _a.sent();
                        if (hasAnyRole) {
                            filteredUsers.push(users[i]);
                        }
                        _a.label = 4;
                    case 4:
                        i++;
                        return [3 /*break*/, 2];
                    case 5: return [2 /*return*/, filteredUsers];
                }
            });
        });
    };
    /**
     * Gets an array of users (not including the current user) who have any of the roles in the supplied list.
     * @param roleNames List of role names to look for
     * @returns Array of user info objects
     */
    /**
     * Gets an array of users (not including the current user) who have any of the roles in the supplied list.
     * @param {?} roleNames List of role names to look for
     * @return {?} Array of user info objects
     */
    IdentityUserService.prototype.getUsersByRolesWithoutCurrentUser = /**
     * Gets an array of users (not including the current user) who have any of the roles in the supplied list.
     * @param {?} roleNames List of role names to look for
     * @return {?} Array of user info objects
     */
    function (roleNames) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var filteredUsers, currentUser_1, users, i, hasAnyRole;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        filteredUsers = [];
                        if (!(roleNames && roleNames.length > 0)) return [3 /*break*/, 5];
                        currentUser_1 = this.getCurrentUserInfo();
                        return [4 /*yield*/, this.getUsers().toPromise()];
                    case 1:
                        users = _a.sent();
                        users = users.filter((/**
                         * @param {?} user
                         * @return {?}
                         */
                        function (user) { return user.username !== currentUser_1.username; }));
                        i = 0;
                        _a.label = 2;
                    case 2:
                        if (!(i < users.length)) return [3 /*break*/, 5];
                        return [4 /*yield*/, this.userHasAnyRole(users[i].id, roleNames)];
                    case 3:
                        hasAnyRole = _a.sent();
                        if (hasAnyRole) {
                            filteredUsers.push(users[i]);
                        }
                        _a.label = 4;
                    case 4:
                        i++;
                        return [3 /*break*/, 2];
                    case 5: return [2 /*return*/, filteredUsers];
                }
            });
        });
    };
    /**
     * @private
     * @param {?} userId
     * @param {?} roleNames
     * @return {?}
     */
    IdentityUserService.prototype.userHasAnyRole = /**
     * @private
     * @param {?} userId
     * @param {?} roleNames
     * @return {?}
     */
    function (userId, roleNames) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var userRoles, hasAnyRole;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.getUserRoles(userId).toPromise()];
                    case 1:
                        userRoles = _a.sent();
                        hasAnyRole = roleNames.some((/**
                         * @param {?} roleName
                         * @return {?}
                         */
                        function (roleName) {
                            /** @type {?} */
                            var filteredRoles = userRoles.filter((/**
                             * @param {?} userRole
                             * @return {?}
                             */
                            function (userRole) {
                                return userRole.name.toLocaleLowerCase() === roleName.toLocaleLowerCase();
                            }));
                            return filteredRoles.length > 0;
                        }));
                        return [2 /*return*/, hasAnyRole];
                }
            });
        });
    };
    /**
     * Checks if a user has one of the roles from a list.
     * @param userId ID of the target user
     * @param roleNames Array of roles to check for
     * @returns True if the user has one of the roles, false otherwise
     */
    /**
     * Checks if a user has one of the roles from a list.
     * @param {?} userId ID of the target user
     * @param {?} roleNames Array of roles to check for
     * @return {?} True if the user has one of the roles, false otherwise
     */
    IdentityUserService.prototype.checkUserHasRole = /**
     * Checks if a user has one of the roles from a list.
     * @param {?} userId ID of the target user
     * @param {?} roleNames Array of roles to check for
     * @return {?} True if the user has one of the roles, false otherwise
     */
    function (userId, roleNames) {
        return this.getUserRoles(userId).pipe(map((/**
         * @param {?} userRoles
         * @return {?}
         */
        function (userRoles) {
            /** @type {?} */
            var hasRole = false;
            if (userRoles && userRoles.length > 0) {
                roleNames.forEach((/**
                 * @param {?} roleName
                 * @return {?}
                 */
                function (roleName) {
                    /** @type {?} */
                    var role = userRoles.find((/**
                     * @param {?} userRole
                     * @return {?}
                     */
                    function (userRole) {
                        return roleName === userRole.name;
                    }));
                    if (role) {
                        hasRole = true;
                        return;
                    }
                }));
            }
            return hasRole;
        })));
    };
    /**
     * @private
     * @return {?}
     */
    IdentityUserService.prototype.buildUserUrl = /**
     * @private
     * @return {?}
     */
    function () {
        return this.appConfigService.get('identityHost') + "/users";
    };
    /**
     * @private
     * @param {?} userId
     * @param {?} clientId
     * @return {?}
     */
    IdentityUserService.prototype.buildUserClientRoleMapping = /**
     * @private
     * @param {?} userId
     * @param {?} clientId
     * @return {?}
     */
    function (userId, clientId) {
        return this.appConfigService.get('identityHost') + "/users/" + userId + "/role-mappings/clients/" + clientId;
    };
    /**
     * @private
     * @param {?} userId
     * @return {?}
     */
    IdentityUserService.prototype.buildRolesUrl = /**
     * @private
     * @param {?} userId
     * @return {?}
     */
    function (userId) {
        return this.appConfigService.get('identityHost') + "/users/" + userId + "/role-mappings/realm/composite";
    };
    /**
     * @private
     * @return {?}
     */
    IdentityUserService.prototype.buildGetClientsUrl = /**
     * @private
     * @return {?}
     */
    function () {
        return this.appConfigService.get('identityHost') + "/clients";
    };
    IdentityUserService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    IdentityUserService.ctorParameters = function () { return [
        { type: JwtHelperService },
        { type: AlfrescoApiService },
        { type: AppConfigService }
    ]; };
    /** @nocollapse */ IdentityUserService.ngInjectableDef = i0.defineInjectable({ factory: function IdentityUserService_Factory() { return new IdentityUserService(i0.inject(i1.JwtHelperService), i0.inject(i2.AlfrescoApiService), i0.inject(i3.AppConfigService)); }, token: IdentityUserService, providedIn: "root" });
    return IdentityUserService;
}());
export { IdentityUserService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    IdentityUserService.prototype.jwtHelperService;
    /**
     * @type {?}
     * @private
     */
    IdentityUserService.prototype.alfrescoApiService;
    /**
     * @type {?}
     * @private
     */
    IdentityUserService.prototype.appConfigService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWRlbnRpdHktdXNlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGFsZnJlc2NvL2FkZi1jb3JlLyIsInNvdXJjZXMiOlsidXNlcmluZm8vc2VydmljZXMvaWRlbnRpdHktdXNlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBYyxJQUFJLEVBQUUsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFaEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDckUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDdkUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0scUNBQXFDLENBQUM7Ozs7O0FBR3pFO0lBS0ksNkJBQ1ksZ0JBQWtDLEVBQ2xDLGtCQUFzQyxFQUN0QyxnQkFBa0M7UUFGbEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNsQyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO1FBQ3RDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7SUFBSSxDQUFDO0lBRW5EOzs7T0FHRzs7Ozs7SUFDSCxnREFBa0I7Ozs7SUFBbEI7O1lBQ1UsVUFBVSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyw0QkFBNEIsQ0FBUyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUM7O1lBQ3JHLFNBQVMsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsNEJBQTRCLENBQVMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDOztZQUNuRyxLQUFLLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLDRCQUE0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REFBa0I7Ozs7SUFBMUI7UUFDSSxPQUFVLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLGFBQVUsQ0FBQztJQUNsRSxDQUFDOztnQkFqV0osVUFBVSxTQUFDO29CQUNSLFVBQVUsRUFBRSxNQUFNO2lCQUNyQjs7OztnQkFQUSxnQkFBZ0I7Z0JBRWhCLGtCQUFrQjtnQkFEbEIsZ0JBQWdCOzs7OEJBdkJ6QjtDQThYQyxBQW5XRCxJQW1XQztTQWhXWSxtQkFBbUI7Ozs7OztJQUd4QiwrQ0FBMEM7Ozs7O0lBQzFDLGlEQUE4Qzs7Ozs7SUFDOUMsK0NBQTBDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZnJvbSwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBJZGVudGl0eVVzZXJNb2RlbCB9IGZyb20gJy4uL21vZGVscy9pZGVudGl0eS11c2VyLm1vZGVsJztcbmltcG9ydCB7IEp3dEhlbHBlclNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9qd3QtaGVscGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXBwQ29uZmlnU2VydmljZSB9IGZyb20gJy4uLy4uL2FwcC1jb25maWcvYXBwLWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7IEFsZnJlc2NvQXBpU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2FsZnJlc2NvLWFwaS5zZXJ2aWNlJztcbmltcG9ydCB7IElkZW50aXR5Um9sZU1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL2lkZW50aXR5LXJvbGUubW9kZWwnO1xuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIElkZW50aXR5VXNlclNlcnZpY2Uge1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgand0SGVscGVyU2VydmljZTogSnd0SGVscGVyU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBhbGZyZXNjb0FwaVNlcnZpY2U6IEFsZnJlc2NvQXBpU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBhcHBDb25maWdTZXJ2aWNlOiBBcHBDb25maWdTZXJ2aWNlKSB7IH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIG5hbWUgYW5kIG90aGVyIGJhc2ljIGRldGFpbHMgb2YgdGhlIGN1cnJlbnQgdXNlci5cbiAgICAgKiBAcmV0dXJucyBUaGUgdXNlcidzIGRldGFpbHNcbiAgICAgKi9cbiAgICBnZXRDdXJyZW50VXNlckluZm8oKTogSWRlbnRpdHlVc2VyTW9kZWwge1xuICAgICAgICBjb25zdCBmYW1pbHlOYW1lID0gdGhpcy5qd3RIZWxwZXJTZXJ2aWNlLmdldFZhbHVlRnJvbUxvY2FsQWNjZXNzVG9rZW48c3RyaW5nPihKd3RIZWxwZXJTZXJ2aWNlLkZBTUlMWV9OQU1FKTtcbiAgICAgICAgY29uc3QgZ2l2ZW5OYW1lID0gdGhpcy5qd3RIZWxwZXJTZXJ2aWNlLmdldFZhbHVlRnJvbUxvY2FsQWNjZXNzVG9rZW48c3RyaW5nPihKd3RIZWxwZXJTZXJ2aWNlLkdJVkVOX05BTUUpO1xuICAgICAgICBjb25zdCBlbWFpbCA9IHRoaXMuand0SGVscGVyU2VydmljZS5nZXRWYWx1ZUZyb21Mb2NhbEFjY2Vzc1Rva2VuPHN0cmluZz4oSnd0SGVscGVyU2VydmljZS5VU0VSX0VNQUlMKTtcbiAgICAgICAgY29uc3QgdXNlcm5hbWUgPSB0aGlzLmp3dEhlbHBlclNlcnZpY2UuZ2V0VmFsdWVGcm9tTG9jYWxBY2Nlc3NUb2tlbjxzdHJpbmc+KEp3dEhlbHBlclNlcnZpY2UuVVNFUl9QUkVGRVJSRURfVVNFUk5BTUUpO1xuICAgICAgICBjb25zdCB1c2VyID0geyBmaXJzdE5hbWU6IGdpdmVuTmFtZSwgbGFzdE5hbWU6IGZhbWlseU5hbWUsIGVtYWlsOiBlbWFpbCwgdXNlcm5hbWU6IHVzZXJuYW1lIH07XG4gICAgICAgIHJldHVybiBuZXcgSWRlbnRpdHlVc2VyTW9kZWwodXNlcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZCB1c2VycyBiYXNlZCBvbiBzZWFyY2ggaW5wdXQuXG4gICAgICogQHBhcmFtIHNlYXJjaCBTZWFyY2ggcXVlcnkgc3RyaW5nXG4gICAgICogQHJldHVybnMgTGlzdCBvZiB1c2Vyc1xuICAgICAqL1xuICAgIGZpbmRVc2Vyc0J5TmFtZShzZWFyY2g6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGlmIChzZWFyY2ggPT09ICcnKSB7XG4gICAgICAgICAgICByZXR1cm4gb2YoW10pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVybCA9IHRoaXMuYnVpbGRVc2VyVXJsKCk7XG4gICAgICAgIGNvbnN0IGh0dHBNZXRob2QgPSAnR0VUJywgcGF0aFBhcmFtcyA9IHt9LCBxdWVyeVBhcmFtcyA9IHsgc2VhcmNoOiBzZWFyY2ggfSwgYm9keVBhcmFtID0ge30sIGhlYWRlclBhcmFtcyA9IHt9LFxuICAgICAgICAgICAgZm9ybVBhcmFtcyA9IHt9LCBjb250ZW50VHlwZXMgPSBbJ2FwcGxpY2F0aW9uL2pzb24nXSwgYWNjZXB0cyA9IFsnYXBwbGljYXRpb24vanNvbiddO1xuXG4gICAgICAgIHJldHVybiAoZnJvbSh0aGlzLmFsZnJlc2NvQXBpU2VydmljZS5nZXRJbnN0YW5jZSgpLm9hdXRoMkF1dGguY2FsbEN1c3RvbUFwaShcbiAgICAgICAgICAgIHVybCwgaHR0cE1ldGhvZCwgcGF0aFBhcmFtcywgcXVlcnlQYXJhbXMsXG4gICAgICAgICAgICBoZWFkZXJQYXJhbXMsIGZvcm1QYXJhbXMsIGJvZHlQYXJhbSxcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlcywgYWNjZXB0cywgT2JqZWN0LCBudWxsLCBudWxsKVxuICAgICAgICApKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaW5kIHVzZXJzIGJhc2VkIG9uIHVzZXJuYW1lIGlucHV0LlxuICAgICAqIEBwYXJhbSB1c2VybmFtZSBTZWFyY2ggcXVlcnkgc3RyaW5nXG4gICAgICogQHJldHVybnMgTGlzdCBvZiB1c2Vyc1xuICAgICAqL1xuICAgIGZpbmRVc2VyQnlVc2VybmFtZSh1c2VybmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgaWYgKHVzZXJuYW1lID09PSAnJykge1xuICAgICAgICAgICAgcmV0dXJuIG9mKFtdKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cmwgPSB0aGlzLmJ1aWxkVXNlclVybCgpO1xuICAgICAgICBjb25zdCBodHRwTWV0aG9kID0gJ0dFVCcsIHBhdGhQYXJhbXMgPSB7fSwgcXVlcnlQYXJhbXMgPSB7IHVzZXJuYW1lOiB1c2VybmFtZSB9LCBib2R5UGFyYW0gPSB7fSwgaGVhZGVyUGFyYW1zID0ge30sXG4gICAgICAgICAgICBmb3JtUGFyYW1zID0ge30sIGNvbnRlbnRUeXBlcyA9IFsnYXBwbGljYXRpb24vanNvbiddLCBhY2NlcHRzID0gWydhcHBsaWNhdGlvbi9qc29uJ107XG5cbiAgICAgICAgcmV0dXJuIChmcm9tKHRoaXMuYWxmcmVzY29BcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkub2F1dGgyQXV0aC5jYWxsQ3VzdG9tQXBpKFxuICAgICAgICAgICAgdXJsLCBodHRwTWV0aG9kLCBwYXRoUGFyYW1zLCBxdWVyeVBhcmFtcyxcbiAgICAgICAgICAgIGhlYWRlclBhcmFtcywgZm9ybVBhcmFtcywgYm9keVBhcmFtLFxuICAgICAgICAgICAgY29udGVudFR5cGVzLCBhY2NlcHRzLCBPYmplY3QsIG51bGwsIG51bGwpXG4gICAgICAgICkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmQgdXNlcnMgYmFzZWQgb24gZW1haWwgaW5wdXQuXG4gICAgICogQHBhcmFtIGVtYWlsIFNlYXJjaCBxdWVyeSBzdHJpbmdcbiAgICAgKiBAcmV0dXJucyBMaXN0IG9mIHVzZXJzXG4gICAgICovXG4gICAgZmluZFVzZXJCeUVtYWlsKGVtYWlsOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICBpZiAoZW1haWwgPT09ICcnKSB7XG4gICAgICAgICAgICByZXR1cm4gb2YoW10pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVybCA9IHRoaXMuYnVpbGRVc2VyVXJsKCk7XG4gICAgICAgIGNvbnN0IGh0dHBNZXRob2QgPSAnR0VUJywgcGF0aFBhcmFtcyA9IHt9LCBxdWVyeVBhcmFtcyA9IHsgZW1haWw6IGVtYWlsIH0sIGJvZHlQYXJhbSA9IHt9LCBoZWFkZXJQYXJhbXMgPSB7fSxcbiAgICAgICAgICAgIGZvcm1QYXJhbXMgPSB7fSwgY29udGVudFR5cGVzID0gWydhcHBsaWNhdGlvbi9qc29uJ10sIGFjY2VwdHMgPSBbJ2FwcGxpY2F0aW9uL2pzb24nXTtcblxuICAgICAgICByZXR1cm4gKGZyb20odGhpcy5hbGZyZXNjb0FwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5vYXV0aDJBdXRoLmNhbGxDdXN0b21BcGkoXG4gICAgICAgICAgICB1cmwsIGh0dHBNZXRob2QsIHBhdGhQYXJhbXMsIHF1ZXJ5UGFyYW1zLFxuICAgICAgICAgICAgaGVhZGVyUGFyYW1zLCBmb3JtUGFyYW1zLCBib2R5UGFyYW0sXG4gICAgICAgICAgICBjb250ZW50VHlwZXMsIGFjY2VwdHMsIE9iamVjdCwgbnVsbCwgbnVsbClcbiAgICAgICAgKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZCB1c2VycyBiYXNlZCBvbiBpZCBpbnB1dC5cbiAgICAgKiBAcGFyYW0gaWQgU2VhcmNoIHF1ZXJ5IHN0cmluZ1xuICAgICAqIEByZXR1cm5zIHVzZXJzIG9iamVjdFxuICAgICAqL1xuICAgIGZpbmRVc2VyQnlJZChpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgaWYgKGlkID09PSAnJykge1xuICAgICAgICAgICAgcmV0dXJuIG9mKFtdKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cmwgPSB0aGlzLmJ1aWxkVXNlclVybCgpICsgJy8nICsgaWQ7XG4gICAgICAgIGNvbnN0IGh0dHBNZXRob2QgPSAnR0VUJywgcGF0aFBhcmFtcyA9IHt9LCBxdWVyeVBhcmFtcyA9IHt9LCBib2R5UGFyYW0gPSB7fSwgaGVhZGVyUGFyYW1zID0ge30sXG4gICAgICAgICAgICBmb3JtUGFyYW1zID0ge30sIGNvbnRlbnRUeXBlcyA9IFsnYXBwbGljYXRpb24vanNvbiddLCBhY2NlcHRzID0gWydhcHBsaWNhdGlvbi9qc29uJ107XG5cbiAgICAgICAgcmV0dXJuIChmcm9tKHRoaXMuYWxmcmVzY29BcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkub2F1dGgyQXV0aC5jYWxsQ3VzdG9tQXBpKFxuICAgICAgICAgICAgdXJsLCBodHRwTWV0aG9kLCBwYXRoUGFyYW1zLCBxdWVyeVBhcmFtcyxcbiAgICAgICAgICAgIGhlYWRlclBhcmFtcywgZm9ybVBhcmFtcywgYm9keVBhcmFtLFxuICAgICAgICAgICAgY29udGVudFR5cGVzLCBhY2NlcHRzLCBPYmplY3QsIG51bGwsIG51bGwpXG4gICAgICAgICkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBjbGllbnQgcm9sZXMgb2YgYSB1c2VyIGZvciBhIHBhcnRpY3VsYXIgY2xpZW50LlxuICAgICAqIEBwYXJhbSB1c2VySWQgSUQgb2YgdGhlIHRhcmdldCB1c2VyXG4gICAgICogQHBhcmFtIGNsaWVudElkIElEIG9mIHRoZSBjbGllbnQgYXBwXG4gICAgICogQHJldHVybnMgTGlzdCBvZiBjbGllbnQgcm9sZXNcbiAgICAgKi9cbiAgICBnZXRDbGllbnRSb2xlcyh1c2VySWQ6IHN0cmluZywgY2xpZW50SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55W10+IHtcbiAgICAgICAgY29uc3QgdXJsID0gdGhpcy5idWlsZFVzZXJDbGllbnRSb2xlTWFwcGluZyh1c2VySWQsIGNsaWVudElkKTtcbiAgICAgICAgY29uc3QgaHR0cE1ldGhvZCA9ICdHRVQnLCBwYXRoUGFyYW1zID0ge30sIHF1ZXJ5UGFyYW1zID0ge30sIGJvZHlQYXJhbSA9IHt9LCBoZWFkZXJQYXJhbXMgPSB7fSxcbiAgICAgICAgICAgIGZvcm1QYXJhbXMgPSB7fSwgY29udGVudFR5cGVzID0gWydhcHBsaWNhdGlvbi9qc29uJ10sIGFjY2VwdHMgPSBbJ2FwcGxpY2F0aW9uL2pzb24nXTtcblxuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmFsZnJlc2NvQXBpU2VydmljZS5nZXRJbnN0YW5jZSgpLm9hdXRoMkF1dGguY2FsbEN1c3RvbUFwaShcbiAgICAgICAgICAgIHVybCwgaHR0cE1ldGhvZCwgcGF0aFBhcmFtcywgcXVlcnlQYXJhbXMsXG4gICAgICAgICAgICBoZWFkZXJQYXJhbXMsIGZvcm1QYXJhbXMsIGJvZHlQYXJhbSxcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlcywgYWNjZXB0cywgT2JqZWN0LCBudWxsLCBudWxsKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyB3aGV0aGVyIHVzZXIgaGFzIGFjY2VzcyB0byBhIGNsaWVudCBhcHAuXG4gICAgICogQHBhcmFtIHVzZXJJZCBJRCBvZiB0aGUgdGFyZ2V0IHVzZXJcbiAgICAgKiBAcGFyYW0gY2xpZW50SWQgSUQgb2YgdGhlIGNsaWVudCBhcHBcbiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSB1c2VyIGhhcyBhY2Nlc3MsIGZhbHNlIG90aGVyd2lzZVxuICAgICAqL1xuICAgIGNoZWNrVXNlckhhc0NsaWVudEFwcCh1c2VySWQ6IHN0cmluZywgY2xpZW50SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRDbGllbnRSb2xlcyh1c2VySWQsIGNsaWVudElkKS5waXBlKFxuICAgICAgICAgICAgbWFwKChjbGllbnRSb2xlczogYW55W10pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY2xpZW50Um9sZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3Mgd2hldGhlciBhIHVzZXIgaGFzIGFueSBvZiB0aGUgY2xpZW50IGFwcCByb2xlcy5cbiAgICAgKiBAcGFyYW0gdXNlcklkIElEIG9mIHRoZSB0YXJnZXQgdXNlclxuICAgICAqIEBwYXJhbSBjbGllbnRJZCBJRCBvZiB0aGUgY2xpZW50IGFwcFxuICAgICAqIEBwYXJhbSByb2xlTmFtZXMgTGlzdCBvZiByb2xlIG5hbWVzIHRvIGNoZWNrIGZvclxuICAgICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHVzZXIgaGFzIG9uZSBvciBtb3JlIG9mIHRoZSByb2xlcywgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICovXG4gICAgY2hlY2tVc2VySGFzQW55Q2xpZW50QXBwUm9sZSh1c2VySWQ6IHN0cmluZywgY2xpZW50SWQ6IHN0cmluZywgcm9sZU5hbWVzOiBzdHJpbmdbXSk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRDbGllbnRSb2xlcyh1c2VySWQsIGNsaWVudElkKS5waXBlKFxuICAgICAgICAgICAgbWFwKChjbGllbnRSb2xlczogYW55W10pID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgaGFzUm9sZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChjbGllbnRSb2xlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJvbGVOYW1lcy5mb3JFYWNoKChyb2xlTmFtZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9sZSA9IGNsaWVudFJvbGVzLmZpbmQoKGF2YWlsYWJsZVJvbGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXZhaWxhYmxlUm9sZS5uYW1lID09PSByb2xlTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocm9sZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1JvbGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBoYXNSb2xlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBjbGllbnQgSUQgZm9yIGFuIGFwcGxpY2F0aW9uLlxuICAgICAqIEBwYXJhbSBhcHBsaWNhdGlvbk5hbWUgTmFtZSBvZiB0aGUgYXBwbGljYXRpb25cbiAgICAgKiBAcmV0dXJucyBDbGllbnQgSUQgc3RyaW5nXG4gICAgICovXG4gICAgZ2V0Q2xpZW50SWRCeUFwcGxpY2F0aW9uTmFtZShhcHBsaWNhdGlvbk5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IHVybCA9IHRoaXMuYnVpbGRHZXRDbGllbnRzVXJsKCk7XG4gICAgICAgIGNvbnN0IGh0dHBNZXRob2QgPSAnR0VUJywgcGF0aFBhcmFtcyA9IHt9LCBxdWVyeVBhcmFtcyA9IHsgY2xpZW50SWQ6IGFwcGxpY2F0aW9uTmFtZSB9LCBib2R5UGFyYW0gPSB7fSwgaGVhZGVyUGFyYW1zID0ge30sIGZvcm1QYXJhbXMgPSB7fSxcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlcyA9IFsnYXBwbGljYXRpb24vanNvbiddLCBhY2NlcHRzID0gWydhcHBsaWNhdGlvbi9qc29uJ107XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuYWxmcmVzY29BcGlTZXJ2aWNlLmdldEluc3RhbmNlKClcbiAgICAgICAgICAgIC5vYXV0aDJBdXRoLmNhbGxDdXN0b21BcGkodXJsLCBodHRwTWV0aG9kLCBwYXRoUGFyYW1zLCBxdWVyeVBhcmFtcywgaGVhZGVyUGFyYW1zLFxuICAgICAgICAgICAgICAgIGZvcm1QYXJhbXMsIGJvZHlQYXJhbSwgY29udGVudFR5cGVzLFxuICAgICAgICAgICAgICAgIGFjY2VwdHMsIE9iamVjdCwgbnVsbCwgbnVsbClcbiAgICAgICAgKS5waXBlKFxuICAgICAgICAgICAgbWFwKChyZXNwb25zZTogYW55W10pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjbGllbnRJZCA9IHJlc3BvbnNlICYmIHJlc3BvbnNlLmxlbmd0aCA+IDAgPyByZXNwb25zZVswXS5pZCA6ICcnO1xuICAgICAgICAgICAgICAgIHJldHVybiBjbGllbnRJZDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGEgdXNlciBoYXMgYWNjZXNzIHRvIGFuIGFwcGxpY2F0aW9uLlxuICAgICAqIEBwYXJhbSB1c2VySWQgSUQgb2YgdGhlIHVzZXJcbiAgICAgKiBAcGFyYW0gYXBwbGljYXRpb25OYW1lIE5hbWUgb2YgdGhlIGFwcGxpY2F0aW9uXG4gICAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgdXNlciBoYXMgYWNjZXNzLCBmYWxzZSBvdGhlcndpc2VcbiAgICAgKi9cbiAgICBjaGVja1VzZXJIYXNBcHBsaWNhdGlvbkFjY2Vzcyh1c2VySWQ6IHN0cmluZywgYXBwbGljYXRpb25OYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q2xpZW50SWRCeUFwcGxpY2F0aW9uTmFtZShhcHBsaWNhdGlvbk5hbWUpLnBpcGUoXG4gICAgICAgICAgICBzd2l0Y2hNYXAoKGNsaWVudElkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGVja1VzZXJIYXNDbGllbnRBcHAodXNlcklkLCBjbGllbnRJZCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBhIHVzZXIgaGFzIGFueSBhcHBsaWNhdGlvbiByb2xlLlxuICAgICAqIEBwYXJhbSB1c2VySWQgSUQgb2YgdGhlIHRhcmdldCB1c2VyXG4gICAgICogQHBhcmFtIGFwcGxpY2F0aW9uTmFtZSBOYW1lIG9mIHRoZSBhcHBsaWNhdGlvblxuICAgICAqIEBwYXJhbSByb2xlTmFtZXMgTGlzdCBvZiByb2xlIG5hbWVzIHRvIGNoZWNrIGZvclxuICAgICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHVzZXIgaGFzIG9uZSBvciBtb3JlIG9mIHRoZSByb2xlcywgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICovXG4gICAgY2hlY2tVc2VySGFzQW55QXBwbGljYXRpb25Sb2xlKHVzZXJJZDogc3RyaW5nLCBhcHBsaWNhdGlvbk5hbWU6IHN0cmluZywgcm9sZU5hbWVzOiBzdHJpbmdbXSk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRDbGllbnRJZEJ5QXBwbGljYXRpb25OYW1lKGFwcGxpY2F0aW9uTmFtZSkucGlwZShcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoY2xpZW50SWQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoZWNrVXNlckhhc0FueUNsaWVudEFwcFJvbGUodXNlcklkLCBjbGllbnRJZCwgcm9sZU5hbWVzKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBkZXRhaWxzIGZvciBhbGwgdXNlcnMuXG4gICAgICogQHJldHVybnMgQXJyYXkgb2YgdXNlciBpbmZvIG9iamVjdHNcbiAgICAgKi9cbiAgICBnZXRVc2VycygpOiBPYnNlcnZhYmxlPElkZW50aXR5VXNlck1vZGVsW10+IHtcbiAgICAgICAgY29uc3QgdXJsID0gdGhpcy5idWlsZFVzZXJVcmwoKTtcbiAgICAgICAgY29uc3QgaHR0cE1ldGhvZCA9ICdHRVQnLCBwYXRoUGFyYW1zID0ge30sIHF1ZXJ5UGFyYW1zID0ge30sIGJvZHlQYXJhbSA9IHt9LCBoZWFkZXJQYXJhbXMgPSB7fSxcbiAgICAgICAgICAgIGZvcm1QYXJhbXMgPSB7fSwgYXV0aE5hbWVzID0gW10sIGNvbnRlbnRUeXBlcyA9IFsnYXBwbGljYXRpb24vanNvbiddLCBhY2NlcHRzID0gWydhcHBsaWNhdGlvbi9qc29uJ107XG5cbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5hbGZyZXNjb0FwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5vYXV0aDJBdXRoLmNhbGxDdXN0b21BcGkoXG4gICAgICAgICAgICB1cmwsIGh0dHBNZXRob2QsIHBhdGhQYXJhbXMsIHF1ZXJ5UGFyYW1zLFxuICAgICAgICAgICAgaGVhZGVyUGFyYW1zLCBmb3JtUGFyYW1zLCBib2R5UGFyYW0sIGF1dGhOYW1lcyxcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlcywgYWNjZXB0cywgbnVsbCwgbnVsbClcbiAgICAgICAgKS5waXBlKFxuICAgICAgICAgICAgbWFwKChyZXNwb25zZTogSWRlbnRpdHlVc2VyTW9kZWxbXSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhIGxpc3Qgb2Ygcm9sZXMgZm9yIGEgdXNlci5cbiAgICAgKiBAcGFyYW0gdXNlcklkIElEIG9mIHRoZSB1c2VyXG4gICAgICogQHJldHVybnMgQXJyYXkgb2Ygcm9sZSBpbmZvIG9iamVjdHNcbiAgICAgKi9cbiAgICBnZXRVc2VyUm9sZXModXNlcklkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPElkZW50aXR5Um9sZU1vZGVsW10+IHtcbiAgICAgICAgY29uc3QgdXJsID0gdGhpcy5idWlsZFJvbGVzVXJsKHVzZXJJZCk7XG4gICAgICAgIGNvbnN0IGh0dHBNZXRob2QgPSAnR0VUJywgcGF0aFBhcmFtcyA9IHt9LCBxdWVyeVBhcmFtcyA9IHt9LCBib2R5UGFyYW0gPSB7fSwgaGVhZGVyUGFyYW1zID0ge30sXG4gICAgICAgICAgICBmb3JtUGFyYW1zID0ge30sIGNvbnRlbnRUeXBlcyA9IFsnYXBwbGljYXRpb24vanNvbiddLCBhY2NlcHRzID0gWydhcHBsaWNhdGlvbi9qc29uJ107XG5cbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5hbGZyZXNjb0FwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5vYXV0aDJBdXRoLmNhbGxDdXN0b21BcGkoXG4gICAgICAgICAgICB1cmwsIGh0dHBNZXRob2QsIHBhdGhQYXJhbXMsIHF1ZXJ5UGFyYW1zLFxuICAgICAgICAgICAgaGVhZGVyUGFyYW1zLCBmb3JtUGFyYW1zLCBib2R5UGFyYW0sXG4gICAgICAgICAgICBjb250ZW50VHlwZXMsIGFjY2VwdHMsIE9iamVjdCwgbnVsbCwgbnVsbClcbiAgICAgICAgKS5waXBlKFxuICAgICAgICAgICAgbWFwKChyZXNwb25zZTogSWRlbnRpdHlSb2xlTW9kZWxbXSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhbiBhcnJheSBvZiB1c2VycyAoaW5jbHVkaW5nIHRoZSBjdXJyZW50IHVzZXIpIHdobyBoYXZlIGFueSBvZiB0aGUgcm9sZXMgaW4gdGhlIHN1cHBsaWVkIGxpc3QuXG4gICAgICogQHBhcmFtIHJvbGVOYW1lcyBMaXN0IG9mIHJvbGUgbmFtZXMgdG8gbG9vayBmb3JcbiAgICAgKiBAcmV0dXJucyBBcnJheSBvZiB1c2VyIGluZm8gb2JqZWN0c1xuICAgICAqL1xuICAgIGFzeW5jIGdldFVzZXJzQnlSb2xlc1dpdGhDdXJyZW50VXNlcihyb2xlTmFtZXM6IHN0cmluZ1tdKTogUHJvbWlzZTxJZGVudGl0eVVzZXJNb2RlbFtdPiB7XG4gICAgICAgIGNvbnN0IGZpbHRlcmVkVXNlcnM6IElkZW50aXR5VXNlck1vZGVsW10gPSBbXTtcbiAgICAgICAgaWYgKHJvbGVOYW1lcyAmJiByb2xlTmFtZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCB0aGlzLmdldFVzZXJzKCkudG9Qcm9taXNlKCk7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXNlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNBbnlSb2xlID0gYXdhaXQgdGhpcy51c2VySGFzQW55Um9sZSh1c2Vyc1tpXS5pZCwgcm9sZU5hbWVzKTtcbiAgICAgICAgICAgICAgICBpZiAoaGFzQW55Um9sZSkge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZFVzZXJzLnB1c2godXNlcnNbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmaWx0ZXJlZFVzZXJzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYW4gYXJyYXkgb2YgdXNlcnMgKG5vdCBpbmNsdWRpbmcgdGhlIGN1cnJlbnQgdXNlcikgd2hvIGhhdmUgYW55IG9mIHRoZSByb2xlcyBpbiB0aGUgc3VwcGxpZWQgbGlzdC5cbiAgICAgKiBAcGFyYW0gcm9sZU5hbWVzIExpc3Qgb2Ygcm9sZSBuYW1lcyB0byBsb29rIGZvclxuICAgICAqIEByZXR1cm5zIEFycmF5IG9mIHVzZXIgaW5mbyBvYmplY3RzXG4gICAgICovXG4gICAgYXN5bmMgZ2V0VXNlcnNCeVJvbGVzV2l0aG91dEN1cnJlbnRVc2VyKHJvbGVOYW1lczogc3RyaW5nW10pOiBQcm9taXNlPElkZW50aXR5VXNlck1vZGVsW10+IHtcbiAgICAgICAgY29uc3QgZmlsdGVyZWRVc2VyczogSWRlbnRpdHlVc2VyTW9kZWxbXSA9IFtdO1xuICAgICAgICBpZiAocm9sZU5hbWVzICYmIHJvbGVOYW1lcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50VXNlciA9IHRoaXMuZ2V0Q3VycmVudFVzZXJJbmZvKCk7XG4gICAgICAgICAgICBsZXQgdXNlcnMgPSBhd2FpdCB0aGlzLmdldFVzZXJzKCkudG9Qcm9taXNlKCk7XG5cbiAgICAgICAgICAgIHVzZXJzID0gdXNlcnMuZmlsdGVyKCh1c2VyKSA9PiB7IHJldHVybiB1c2VyLnVzZXJuYW1lICE9PSBjdXJyZW50VXNlci51c2VybmFtZTsgfSk7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXNlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNBbnlSb2xlID0gYXdhaXQgdGhpcy51c2VySGFzQW55Um9sZSh1c2Vyc1tpXS5pZCwgcm9sZU5hbWVzKTtcbiAgICAgICAgICAgICAgICBpZiAoaGFzQW55Um9sZSkge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZFVzZXJzLnB1c2godXNlcnNbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmaWx0ZXJlZFVzZXJzO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgdXNlckhhc0FueVJvbGUodXNlcklkOiBzdHJpbmcsIHJvbGVOYW1lczogc3RyaW5nW10pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgICAgY29uc3QgdXNlclJvbGVzID0gYXdhaXQgdGhpcy5nZXRVc2VyUm9sZXModXNlcklkKS50b1Byb21pc2UoKTtcbiAgICAgICAgY29uc3QgaGFzQW55Um9sZSA9IHJvbGVOYW1lcy5zb21lKChyb2xlTmFtZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRSb2xlcyA9IHVzZXJSb2xlcy5maWx0ZXIoKHVzZXJSb2xlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJSb2xlLm5hbWUudG9Mb2NhbGVMb3dlckNhc2UoKSA9PT0gcm9sZU5hbWUudG9Mb2NhbGVMb3dlckNhc2UoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZmlsdGVyZWRSb2xlcy5sZW5ndGggPiAwO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gaGFzQW55Um9sZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgYSB1c2VyIGhhcyBvbmUgb2YgdGhlIHJvbGVzIGZyb20gYSBsaXN0LlxuICAgICAqIEBwYXJhbSB1c2VySWQgSUQgb2YgdGhlIHRhcmdldCB1c2VyXG4gICAgICogQHBhcmFtIHJvbGVOYW1lcyBBcnJheSBvZiByb2xlcyB0byBjaGVjayBmb3JcbiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSB1c2VyIGhhcyBvbmUgb2YgdGhlIHJvbGVzLCBmYWxzZSBvdGhlcndpc2VcbiAgICAgKi9cbiAgICBjaGVja1VzZXJIYXNSb2xlKHVzZXJJZDogc3RyaW5nLCByb2xlTmFtZXM6IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFVzZXJSb2xlcyh1c2VySWQpLnBpcGUobWFwKCh1c2VyUm9sZXM6IElkZW50aXR5Um9sZU1vZGVsW10pID0+IHtcbiAgICAgICAgICAgIGxldCBoYXNSb2xlID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodXNlclJvbGVzICYmIHVzZXJSb2xlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcm9sZU5hbWVzLmZvckVhY2goKHJvbGVOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9sZSA9IHVzZXJSb2xlcy5maW5kKCh1c2VyUm9sZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvbGVOYW1lID09PSB1c2VyUm9sZS5uYW1lO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc1JvbGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaGFzUm9sZTtcbiAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYnVpbGRVc2VyVXJsKCk6IGFueSB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmFwcENvbmZpZ1NlcnZpY2UuZ2V0KCdpZGVudGl0eUhvc3QnKX0vdXNlcnNgO1xuICAgIH1cblxuICAgIHByaXZhdGUgYnVpbGRVc2VyQ2xpZW50Um9sZU1hcHBpbmcodXNlcklkOiBzdHJpbmcsIGNsaWVudElkOiBzdHJpbmcpOiBhbnkge1xuICAgICAgICByZXR1cm4gYCR7dGhpcy5hcHBDb25maWdTZXJ2aWNlLmdldCgnaWRlbnRpdHlIb3N0Jyl9L3VzZXJzLyR7dXNlcklkfS9yb2xlLW1hcHBpbmdzL2NsaWVudHMvJHtjbGllbnRJZH1gO1xuICAgIH1cblxuICAgIHByaXZhdGUgYnVpbGRSb2xlc1VybCh1c2VySWQ6IHN0cmluZyk6IGFueSB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmFwcENvbmZpZ1NlcnZpY2UuZ2V0KCdpZGVudGl0eUhvc3QnKX0vdXNlcnMvJHt1c2VySWR9L3JvbGUtbWFwcGluZ3MvcmVhbG0vY29tcG9zaXRlYDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGJ1aWxkR2V0Q2xpZW50c1VybCgpIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuYXBwQ29uZmlnU2VydmljZS5nZXQoJ2lkZW50aXR5SG9zdCcpfS9jbGllbnRzYDtcbiAgICB9XG5cbn1cbiJdfQ==